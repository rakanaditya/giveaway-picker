<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Neon Spectrum Pro</title>

<style>
body 
{
  
background:
    linear-gradient(rgba(0,0,0,.65),rgba(0,0,0,.65)),
    url("https://i.imgur.com/53m3Fo5.png") center/cover no-repeat;
  color:#fff;  
  
margin:0;background:#000;color:#fff;font-family:sans-serif;overflow:hidden}
canvas{position:fixed;inset:0}
.panel{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);
width:95%;max-width:560px;background:rgba(0,0,0,.75);
backdrop-filter:blur(10px);border-radius:14px;padding:12px;
box-shadow:0 0 20px #0ff}
.row{display:flex;gap:8px;margin-top:6px}
button,input[type=range],select{
flex:1;background:#111;border:none;border-radius:10px;
padding:8px;color:#0ff;box-shadow:0 0 10px #0ff}
button.active{color:#f0f;box-shadow:0 0 15px #f0f}
label{font-size:12px;opacity:.9}
</style>
</head>

<body>

<input id="playlist" type="file" multiple accept="audio/*" style="position:fixed;top:10px;left:10px;z-index:10">

<canvas id="c"></canvas>

<div class="panel">
  <div class="row">
    <button id="prev">‚èÆ</button>
    <button id="play">‚ñ∂Ô∏è</button>
    <button id="pause">‚è∏Ô∏è</button>
    <button id="stop">‚èπ</button>
    <button id="loop">üîÅ</button>
    <button id="rec">‚è∫</button>
  </div>

  <div class="row">
    <label>Volume</label>
    <input id="vol" type="range" min="0" max="1" step="0.01" value="1">
    <label>Bass Boost</label>
    <input id="bass" type="range" min="-40" max="20" step="1" value="0">
  </div>

  <div class="row">
    <input id="seek" type="range" min="0" max="100" value="0">
  </div>

  <div class="row">
    <select id="list"></select>
    <input id="yt" placeholder="Tempel URL audio YouTube (stream)">
    <button id="loadYT">Load</button>
  </div>

  <div class="row">
    <span id="time">0:00 / 0:00</span>
  </div>
</div>

<audio id="audio"></audio>

<script>
const a = audio;
let ctx, analyser, src, data;
let bassEQ, gainNode;
let recStream, recorder, chunks=[];
let files=[], index=0;

const cvs=c, g=cvs.getContext("2d");
function size(){cvs.width=innerWidth;cvs.height=innerHeight}
size(); addEventListener("resize",size);

/* ==== AUDIO GRAPH ==== */
function init(){
  if(ctx) return;
  ctx=new AudioContext();
  analyser=ctx.createAnalyser();
  analyser.fftSize=256;
  data=new Uint8Array(analyser.frequencyBinCount);

  gainNode=ctx.createGain();
  bassEQ=ctx.createBiquadFilter();
  bassEQ.type="lowshelf";
  bassEQ.frequency.value=150;

  src=ctx.createMediaElementSource(a);
  src.connect(bassEQ);
  bassEQ.connect(gainNode);
  gainNode.connect(analyser);
  analyser.connect(ctx.destination);

  draw();
}

/* ==== VISUALIZER ==== */
let shake=0, flash=0;
function draw(){
  requestAnimationFrame(draw);
  analyser.getByteFrequencyData(data);
  let bass = data.slice(0,12).reduce((a,b)=>a+b)/12;
  if(bass>170){shake=12;flash=1}
  g.clearRect(0,0,cvs.width,cvs.height);

  g.save();
  g.translate((Math.random()-.5)*shake,(Math.random()-.5)*shake);
  shake*=.9;

  const bars=data.length, w=cvs.width/bars;
  for(let i=0;i<bars;i++){
    const v=data[i], h=v*2;
    const x=i*w, y=cvs.height/2-h/2;
    const hue=(bass*2+i*2)%360;
    const grd=g.createLinearGradient(0,y,0,y+h);
    grd.addColorStop(0,`hsl(${hue},100%,60%)`);
    grd.addColorStop(1,`hsl(${hue+60},100%,50%)`);
    g.fillStyle=grd; g.shadowBlur=18; g.shadowColor=`hsl(${hue},100%,60%)`;
    g.fillRect(x+1,y,w-2,h);
  }
  g.restore();

  if(flash>0){
    g.fillStyle=`rgba(255,255,255,${flash*.12})`;
    g.fillRect(0,0,cvs.width,cvs.height);
    flash*=.85;
  }
}

/* ==== UI ==== */
function loadTrack(i){
  index=i;
  a.src=files[i].url;
  a.play(); init();
  document.getElementById("list").selectedIndex=i;
}

playlist.onchange=()=>{
  files=[...playlist.files].map(f=>({name:f.name,url:URL.createObjectURL(f)}));
  list.innerHTML=files.map((f,i)=>`<option value="${i}">${f.name}</option>`).join("");
  if(files.length) loadTrack(0);
};

list.onchange=()=>loadTrack(+list.value);

prev.onclick=()=>{ if(index>0) loadTrack(index-1); };
play.onclick=()=>{ a.play(); init(); };
pause.onclick=()=>a.pause();
stop.onclick=()=>{a.pause();a.currentTime=0};
loop.onclick=()=>{a.loop=!a.loop;loop.classList.toggle("active",a.loop)};

vol.oninput=e=>gainNode.gain.value=e.target.value;
bass.oninput=e=>bassEQ.gain.value=e.target.value;

a.ontimeupdate=()=>{
  seek.value=(a.currentTime/a.duration)*100||0;
  time.textContent=f(a.currentTime)+" / "+f(a.duration);
};
seek.oninput=()=>a.currentTime=(seek.value/100)*a.duration;
function f(t){if(!t)return"0:00";const m=Math.floor(t/60),s=String(Math.floor(t%60)).padStart(2,"0");return `${m}:${s}`;}

a.onended=()=>{ if(index<files.length-1) loadTrack(index+1); };

/* ==== EXPORT VIDEO (WEBM) ==== */
rec.onclick=()=>{
  if(!recorder){
    recStream=cvs.captureStream(60);
    recorder=new MediaRecorder(recStream,{mimeType:"video/webm"});
    recorder.ondataavailable=e=>chunks.push(e.data);
    recorder.onstop=()=>{
      const blob=new Blob(chunks,{type:"video/webm"});
      const url=URL.createObjectURL(blob);
      const a=document.createElement("a");
      a.href=url;a.download="visualizer.webm";a.click();
      chunks=[];recorder=null;
    };
    recorder.start(); rec.classList.add("active");
  } else {
    recorder.stop(); rec.classList.remove("active");
  }
};

/* ==== LOAD YOUTUBE AUDIO STREAM ==== */
loadYT.onclick=()=>{
  if(!yt.value) return;
  a.src=yt.value; // HARUS berupa direct audio stream
  a.play(); init();
};
</script>

</body>
</html>
