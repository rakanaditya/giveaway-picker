<!DOCTYPE html>
<html>
<head>
  <title>🎉 Random Giveaway Picker</title>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="container">
    <h1>🎁 Discord Giveaway</h1>

    <form id="giveawayForm">
      <input type="text" id="username" placeholder="🧑 Username Discord" required />
      <input type="number" id="number" placeholder="🎲 Angka (1–1000)" min="1" max="1000" required />
      <button type="submit">🚀 Kirim</button>
      <div id="formStatus"></div>
    </form>

    <div id="winner" class="winner">Loading winner...</div>

    <h3>📋 All Participants</h3>
    <div id="participants"></div>
  </div>

  <script>
    document.getElementById("giveawayForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const username = document.getElementById("username").value.trim();
      const number = parseInt(document.getElementById("number").value.trim());
      const statusEl = document.getElementById("formStatus");

      if (!username) return statusEl.textContent = "❌ Username tidak boleh kosong!";
      if (isNaN(number) || number < 1 || number > 1000) return statusEl.textContent = "❌ Angka harus 1–1000";

      const res = await fetch("/api/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ author: { username }, content: number })
      });
      const text = await res.text();

      if (text === "OK") {
        statusEl.textContent = "✅ Submit berhasil!";
        fetchData(); // refresh peserta
      } else if (text === "Sudah submit") {
        statusEl.textContent = "⚠️ Kamu sudah ikut!";
      } else {
        statusEl.textContent = "❌ Gagal: " + text;
      }
    });

    async function fetchData() {
      const res = await fetch("/api/data");
      const data = await res.json();
      const winnerEl = document.getElementById("winner");
      const partList = document.getElementById("participants");

      if (data.winner) {
        winnerEl.textContent = `🏆 Pemenang: ${data.winner.username} (${data.winner.number})`;
      } else {
        winnerEl.textContent = "Belum ada peserta.";
      }

      partList.innerHTML = data.participants.map(p =>
        `<div class="participant">${p.username} (${p.number})</div>`
      ).join('');
    }

    fetchData();
    setInterval(fetchData, 5000);
  </script>
</body>
</html>
