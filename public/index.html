<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🎉 Random Giveaway Picker</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="container">
    <h1>🎁 Discord Giveaway Tracker</h1>

    <form id="giveawayForm" class="form">
      <input type="text" id="username" placeholder="🧑 Username Discord" autocomplete="off" required />
      <input type="number" id="number" placeholder="🎲 Angka (1–1000)" min="1" max="1000" required />
      <button type="submit">🚀 Kirim</button>
      <div id="formStatus" class="status-message"></div>
    </form>

    <div id="winner" class="winner">⏳ Memuat pemenang...</div>

    <h3>📋 Semua Peserta</h3>
    <div id="participants" class="participant-list">Memuat peserta...</div>
  </div>
<script>
  const form = document.getElementById("giveawayForm");
  const usernameInput = document.getElementById("username");
  const numberInput = document.getElementById("number");
  const statusEl = document.getElementById("formStatus");
  const winnerEl = document.getElementById("winner");
  const partList = document.getElementById("participants");

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    const username = usernameInput.value.trim();
    const number = parseInt(numberInput.value.trim());

    if (!username) {
      statusEl.textContent = "❌ Username tidak boleh kosong!";
      return;
    }

    if (isNaN(number) || number < 1 || number > 1000) {
      statusEl.textContent = "❌ Angka harus antara 1 sampai 1000!";
      return;
    }

    try {
      const res = await fetch("/api/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ author: { username }, content: number })
      });

      const text = await res.text();
      if (text === "OK") {
        statusEl.textContent = "✅ Submit berhasil!";
        form.reset();
        fetchData(); // refresh peserta
      } else {
        statusEl.textContent = "⚠️ Gagal submit: " + text;
      }
    } catch (err) {
      statusEl.textContent = "❌ Error saat mengirim: " + err.message;
    }
  });

  async function fetchData() {
    try {
      const res = await fetch("/api/data");
      const data = await res.json();

      if (data.winner) {
        winnerEl.textContent = `🏆 Pemenang: ${data.winner.username} (${data.winner.number})`;
      } else {
        winnerEl.textContent = "Belum ada peserta.";
      }

      partList.innerHTML = data.participants.map(p =>
        `<div class="participant">👤 ${p.username} — 🎯 ${p.number}</div>`
      ).join('');
    } catch (err) {
      winnerEl.textContent = "❌ Gagal memuat data";
      partList.textContent = "🚫 Tidak dapat mengambil peserta";
    }
  }

  fetchData();
  setInterval(fetchData, 5000);
</script>

 
</body>
</html>
